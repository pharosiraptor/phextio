<!DOCTYPE html>
<html>
<head>
<title>phext.io - open-source knowledge</title>
<style type="text/css">
body {
  background: black;
  color: white;
  font-family: sans-serif;
}
#phext {
  width: 400px;
  min-height: 320px;
}
textarea {
  font-family: monospace;
}
#hyperJump {
  width: 80px;
  height: 23px;
}
#coordsX,
#coordsY,
#coordsZ,
#pscrollbreak,
#psectionbreak,
#pchapterbreak,
#pbookbreak,
#pvolumebreak,
#pcollectionbreak,
#pseriesbreak,
#pshelfbreak,
#plibrarybreak,
#targetCoordinates {
  font-family: monospace;
}
#targetCoordinates {
  font-size: 1.6em;
}
#redPill {
  background: red;
  color: white;
  font-weight: bold;
  border-radius: 12px;
  padding: 12px;
}
#bluePill {
  background: blue;
  color: white;
  font-weight: bold;
  border-radius: 12px;
  padding: 12px;
}
a, a:visited {
  color: white;
  font-size: 2em;
}
#linker {
  margin: 8px;
  background-color: #171742;
  padding: 8px;
  margin-bottom: 32px;
}
</style>
<script type="text/javascript">

<!-- paste your phext data here -->

var raw = "<html>\n<head>\n<title>Reference Phext Document</title>\n</head>\n<body>\n\nYou are currently at 1.1.1/1.1.1/1.1.1.\nWe are aware of the following nodes:\n\n<a href='phext://1.1.1/1.1.1/1.1.2'>Scroll #2</a>\n<a href='phext://1.1.1/1.1.1/1.1.3'>Scroll #3</a>\n<a href='phext://1.1.1/1.1.1/1.1.4'>Scroll #4</a>\n\n</body>\n</html>Scroll #2\n---------\nThis happens to be a MarkDown file.\n\nScroll #3: Just a line of text.<html>\n<head>\n<title>Scroll #4</title>\n</head>\n<body>\n<a href='phext://1.1.1/1.1.1/1.1.1'>Return Home</a>\n\n<h1>Scroll #4</h1>\n</body>\n</html>";


<!-- changes below here might break the renderer -->


const LINE_BREAK       = '\n';   // 2nd (Newline)
const SCROLL_BREAK     = '\x17'; // 3rd
const SECTION_BREAK    = '\x18'; // 4th
const CHAPTER_BREAK    = '\x19'; // 5th
const BOOK_BREAK       = '\x1A'; // 6th
const VOLUME_BREAK     = '\x1C'; // 7th
const COLLECTION_BREAK = '\x1D'; // 8th
const SERIES_BREAK     = '\x1E'; // 9th
const SHELF_BREAK      = '\x1F'; // 10th
const LIBRARY_BREAK    = '\x01'; // 11th

var DimensionBreaks = new Array(
  SCROLL_BREAK,
  SECTION_BREAK,
  CHAPTER_BREAK,
  BOOK_BREAK,
  VOLUME_BREAK,
  COLLECTION_BREAK,
  SERIES_BREAK,
  SHELF_BREAK,
  LIBRARY_BREAK
);
function defaultCoordinates() {
  var coordinates = new Array();
  coordinates[LINE_BREAK] = 1;
  coordinates[SCROLL_BREAK] = 1;
  coordinates[SECTION_BREAK] = 1;
  coordinates[CHAPTER_BREAK] = 1;
  coordinates[BOOK_BREAK] = 1;
  coordinates[VOLUME_BREAK] = 1;
  coordinates[COLLECTION_BREAK] = 1;
  coordinates[SERIES_BREAK] = 1;
  coordinates[SHELF_BREAK] = 1;
  coordinates[LIBRARY_BREAK] = 1;
  return coordinates;
}

var ta = false;
var cs = false;
var ls = false;
var cx = false;
var cy = false;
var cz = false;
var wr = false;
var st = false;
var phextCoordinate = "1.1.1/1.1.1/1.1.1";

function loadVars() {
  if (!ta) {
    ta = document.getElementById("scroll");
  }
  if (!cs) {
    cs = document.getElementById("coords");
  }
  if (!ls) {
    ls = document.getElementById("subspace");
  }
  if (!cx) {
    cx = document.getElementById("coordsX");
  }
  if (!cy) {
    cy = document.getElementById("coordsY");
  }
  if (!cz) {
    cz = document.getElementById("coordsZ");
  }
  if (!wr) {
    wr = document.getElementById("whiterabbit");
  }
  if (!st) {
    st = document.getElementById("subspaceTitle");
  }
}

function updateCoordinate() {
  phextCoordinate = cx.value + "/" + cy.value + "/" + cz.value;
}

var coords = defaultCoordinates();
var target = defaultCoordinates();
var scrollFound = false;

function grabScroll() {
  if (ls.value.trim().length > 0) {
    raw = ls.value;
  } else {
    ls.value = raw;
  }
  coords = defaultCoordinates();
  var gz = cz.value.split('.');
  var gy = cy.value.split('.');
  var gx = cx.value.split('.');
  if (gz.length >= 1) { target[LIBRARY_BREAK] = gz[0]; }
  if (gz.length >= 2) { target[SHELF_BREAK] = gz[1]; }
  if (gz.length >= 3) { target[SERIES_BREAK] = gz[2]; }
  if (gy.length >= 1) { target[COLLECTION_BREAK] = gy[0]; }
  if (gy.length >= 2) { target[VOLUME_BREAK] = gy[1]; }
  if (gy.length >= 3) { target[BOOK_BREAK] = gy[2]; }
  if (gx.length >= 1) { target[CHAPTER_BREAK] = gx[0]; }
  if (gx.length >= 2) { target[SECTION_BREAK] = gx[1]; }
  if (gx.length >= 3) { target[SCROLL_BREAK] = gx[2]; }

  scrollFound = false;
  var libs = raw.split(LIBRARY_BREAK);
  libs.forEach((library) => processLibrary(library));
  if (!scrollFound) {
    ta.value = "";
  }
}

function processLibrary(library) {
  var shelves = library.split(SHELF_BREAK);
  shelves.forEach((shelf) => processShelf(shelf));
  ++coords[LIBRARY_BREAK];
}

function processShelf(shelf) {
  var series = shelf.split(SERIES_BREAK);
  series.forEach((seri) => processSeries(seri));
  ++coords[SHELF_BREAK];
}

function processSeries(seri) {
  var collections = seri.split(COLLECTION_BREAK);
  collections.forEach((collection) => processCollection(collection));
  ++coords[SERIES_BREAK];
}

function processCollection(collection) {
  var volumes = collection.split(VOLUME_BREAK);
  volumes.forEach((volume) => processVolume(volume));
  ++coords[COLLECTION_BREAK];
}

function processVolume(volume) {
  var books = volume.split(BOOK_BREAK);
  books.forEach((book) => processBook(book));
  ++coords[VOLUME_BREAK];
}

function processBook(book) {
  var chapters = book.split(CHAPTER_BREAK);
  chapters.forEach((chapter) => processChapter(chapter));
  ++coords[BOOK_BREAK];
}

function processChapter(chapter) {
  var sections = chapter.split(SECTION_BREAK);
  sections.forEach((section) => processSection(section));
  ++coords[CHAPTER_BREAK];
}

function processSection(section) {
  var sections = section.split(SCROLL_BREAK);
  sections.forEach((scroll) => processScroll(scroll));
  ++coords[SECTION_BREAK];
}

function coordinatesMatch(a, b) {
  return a[SCROLL_BREAK]     == b[SCROLL_BREAK] &&
         a[SECTION_BREAK]    == b[SECTION_BREAK] &&
         a[CHAPTER_BREAK]    == b[CHAPTER_BREAK] &&
         a[BOOK_BREAK]       == b[BOOK_BREAK] &&
         a[VOLUME_BREAK]     == b[VOLUME_BREAK] &&
         a[COLLECTION_BREAK] == b[COLLECTION_BREAK] &&
         a[SERIES_BREAK]     == b[SERIES_BREAK] &&
         a[SHELF_BREAK]      == b[SHELF_BREAK] &&
         a[LIBRARY_BREAK]    == b[LIBRARY_BREAK];
}

function processScroll(scroll) {
  if (coordinatesMatch(target, coords))
  {
    ta.value = scroll;
    scrollFound = true;
    var lineCount = scroll.split('\n').length;
    if (lineCount < 100) { ta.rows = lineCount; }
    else { ta.rows = 100; }
  }
  ++coords[SCROLL_BREAK];
}

function jump() {
  ls.value = raw;
  st.innerHTML = "Follow the White Rabbit.";
  wr.style.display = 'block';
  ta.style.display = 'block';

  updateCoordinate();
  grabScroll();
  ls.value = raw;

  document.getElementById("linker").href = "?q=" + encodeURIComponent(raw) + "#RedPill";
}

function load() {
  wr.style.display = 'none';
  ta.style.display = 'none';

  ta.value = raw;
  ta.rows = raw.split('\n').length;

  st.innerHTML = "Believe";
  ta.value = raw;

  document.getElementById("linker").href = "?q=" + encodeURIComponent(raw) + "#BluePill";
}

function loadPhextHelper() {
  document.getElementById("pscrollbreak").value = SCROLL_BREAK;
  document.getElementById("psectionbreak").value = SECTION_BREAK;
  document.getElementById("pchapterbreak").value = CHAPTER_BREAK;
  document.getElementById("pbookbreak").value = BOOK_BREAK;
  document.getElementById("pvolumebreak").value = VOLUME_BREAK;
  document.getElementById("pcollectionbreak").value = COLLECTION_BREAK;
  document.getElementById("pseriesbreak").value = SERIES_BREAK;
  document.getElementById("pshelfbreak").value = SHELF_BREAK;
  document.getElementById("plibrarybreak").value = LIBRARY_BREAK;
  loadVars();

  var urlSearchParams = new URLSearchParams(window.location.search);
  var params = Object.fromEntries(urlSearchParams.entries());
  if (params.q) {
    raw = params.q;
  }

  ls.value = raw;
}
</script>
</head>
<body onload="loadPhextHelper();">

<div id="root">
<h1>Phext</h1>
<table>
  <tr><th>Scroll</th><td><input id="pscrollbreak" type="text" value="" size="1" /></td>
  <th>Section</th><td><input id="psectionbreak" type="text" value="" size="1" /></td>
  <th>Chapter</th><td><input id="pchapterbreak" type="text" value="" size="1" /></td></tr>

  <tr><th>Book</th><td><input id="pbookbreak" type="text" value="" size="1" /></td>
  <th>Volume</th><th><input id="pvolumebreak" type="text" value="" size="1" /></td>
  <th>Collection</th><td><input id="pcollectionbreak" type="text" value="" size="1" /></td></tr>

  <tr><th>Series</th><td><input id="pseriesbreak" type="text" value="" size="1" /></td>
  <th>Shelf</th><td><input id="pshelfbreak" type="text" value="" size="1" /></td>
  <th>Library</th><td><input id="plibrarybreak" type="text" value="" size="1" /></td></tr>
</table>
</div>

<div id="phext">
<ul>
  <li>Location:
    <input type="text" id="coordsZ" name="coordsZ" value="1.1.1" size="8" />/
    <input type="text" id="coordsY" name="coordsY" value="1.1.1" size="8" />/
    <input type="text" id="coordsX" name="coordsX" value="1.1.1" size="8" />
  </li>
</ul>
<input id="redPill" type="button" onclick="jump();" value="Red Pill" />
<input id="bluePill" type="button" onclick="load();" value="Blue Pill" />


  <h1 id="whiterabbit">Scroll</h1>
  <a id="linker" href="#WhiteRabbit">Share This Phext</a>
  <textarea id="scroll" name="scroll" rows="5" cols="110">Unfortunately, no one can be told what #phext is...you have to experience it for yourself.</textarea>
 
  <h1 id="subspaceTitle">Subspace</h1>
  <textarea id="subspace" name="subspace" rows="30" cols="200">
  </textarea>
</div>

</body>
</html>